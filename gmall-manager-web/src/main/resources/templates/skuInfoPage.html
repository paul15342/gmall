<!DOCTYPE html><html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head>    <meta charset="UTF-8">    <title>Title</title></head><body>    <div id="sku_dlg" class="easyui-dialog" title="编辑sku" style="width:700px;height:520px;"         closed="true"  data-options="iconCls:'icon-save',resizable:true,modal:false" buttons="#skuBtns" >        <form id="skuForm">            <br/>            <label>sku名称:</label>            <input  id="skuName" name="skuName" class="easyui-textbox"  style="width:300px;"/>            <br/><br/>            <label>商品价格:</label>            <input  id="price" name="price" class="easyui-numberbox" data-options="min:0,precision:2" style="width:300px;"/>            <br/><br/>            <label>商品重量（千克):</label>            <input  id="weight" name="weight" class="easyui-numberbox" data-options="min:0,precision:2" style="width:300px;"/>            <br/><br/>            <label>商品规格描述:</label>            <input  id="skuDesc" name="skuDesc" class="easyui-textbox" data-options="multiline:true" style="width:500px;height:100px"/>            <input id="spuIdForSku" name="spuId" type="hidden"/>            <input id="skuId" name="id" type="hidden"/>            <input id="catalog3IdForSku" name="catalog3Id" type="hidden"/>            <br/><br/>            <input id="skuInfo" name="skuInfo" type="hidden"/>            <div id="attrInfoGroup"  title="平台属性" class="easyui-panel" style="padding:5px;" >            </div>            <div id="spuSaleAttrGroup" title="销售属性" class="easyui-panel" style="padding:5px;" >            </div>            <!----------------商品图片列表 ----------------------->            <table id="skuImgDg" class="easyui-datagrid" title="商品图片列表"                   data-options="singleSelect:false,selectOnCheck:false,method:'get'" ></table>            <br/><br/>            <!-------------->        </form>    </div>    <!----------------弹出框的按钮组----------------------->    <div id="skuBtns">        <a href="#" class="easyui-linkbutton" onclick="saveSku()">保 存</a>        <a href="#" class="easyui-linkbutton" onclick="closeSku()">关 闭</a>    </div></body><script language="JavaScript">    function  initSkuInfoDlg(){        var spu = $("#spulist_dg").datagrid("getSelected");        var spuId = spu.id;        var catalog3Id = $("#ctg3ForSpuList").combobox("getValue")        alert(catalog3Id)        if(!catalog3Id){            catalog3Id = 61        }        //初始化图片list        initSkuImgListDatagrid(spuId)        //初始化销售属性列表        initSpuSaleAttrGroup(spuId);        //初始化平台属性        initAttrInfoGroup(catalog3Id);    }    //初始化图片列表    function  initSkuImgListDatagrid(spuId){        $("#skuImgDg").datagrid({url:"imgList?spuId="+spuId,            columns:[[            {field:' ',title:'复选框', checkbox:true},            {field:'id',title:'文件编号',width:100},            {field:'imgName',title:'图片简称',width:100},            {field:'imgUrl',title:'图片路径',width:100,                formatter: function(value,row,index) {                    return "<img src='"+row.imgUrl+"' height='80'>"                }                },            {field:'isDefault',title:'是否默认图片',width:100,                formatter: function(value,row,index) {                    return "<input type='radio' name='isD' value='"+row.imgUrl+"'>"                }            }        ]]        }    )    }    //初始化平台属性    function initAttrInfoGroup(catalog3Id) {        var param = {            catalog3Id:catalog3Id        }        $.post("attrInfoList",param,function (data) {            $("#attrInfoGroup").empty();            for (var i = 0; i < data.length; i++) {                var spanhead ="<span attrId='"+data[i].id+"' attrName='"+data[i].attrName+"'>"+data[i].attrName +":";                var selectHead = "<select>"                var options =""                var attrValueList = data[i].attrValueList;                for (var j = 0; j < attrValueList.length; j++) {                    options = options+ "<option value='"+attrValueList[j].id+"'>" + attrValueList[j].valueName +"</option>";                    //attrId='"+attrValueList[j].attrId+"'                }                var selectedEnd = "</select>"                var spanEnd = "</span>"                $("#attrInfoGroup").append(spanhead+selectHead+options+selectedEnd+spanEnd);            }        })    }    //初始化销售属性    function initSpuSaleAttrGroup(spuId){        var param = {            spuId:spuId        }        $.post("spuSaleAttr",param,function (data){            console.log("data"+data);            $("#spuSaleAttrGroup").empty();            for (var i = 0; i < data.length; i++) {                var spanhead ="<span saleAttrId='"+data[i].saleAttrId+"' saleAttrName='"+data[i].saleAttrName+"'>"+data[i].saleAttrName +":";                var selectHead = "<select>"                var options =""                var spuSaleAttrValues = data[i].spuSaleAttrValueList;                for (var j = 0; j < spuSaleAttrValues.length; j++) {                    options = options+ "<option saleAttrValueId='"+spuSaleAttrValues[j].id+"' saleAttrValueName='"+spuSaleAttrValues[j].saleAttrValueName+"'>" + spuSaleAttrValues[j].saleAttrValueName +"</option>";                }                var selectedEnd = "</select>"                var spanEnd = "</span>"                $("#spuSaleAttrGroup").append(spanhead+selectHead+options+selectedEnd+spanEnd);            }        })    }    function saveSku() {        var skuInfo = {}        skuInfo["skuName"] = $("#skuName").textbox("getValue")        skuInfo["price"] = $("#price").numberbox("getValue")        skuInfo["weight"] = $("#weight").numberbox("getValue")        skuInfo["skuDesc"] = $("#skuDesc").textbox("getValue")        var catlog3Id = $("#ctg3ForSpuList").combobox('getValue');        skuInfo["catalog3Id"] = catlog3Id;        var spuId = $("#spulist_dg").datagrid("getSelected").id;        skuInfo["spuId"] = spuId;        //获取销售属性的数据        var spans = $("#spuSaleAttrGroup > span");        $(spans).each(function (i,span) {            var saleAttrName =  $(span).attr("saleattrname");            var saleAttrId = $(span).attr("saleattrid");            skuInfo["skuSaleAttrValueList["+i+"].saleAttrId"] = saleAttrId;            skuInfo["skuSaleAttrValueList["+i+"].saleAttrName"] = saleAttrName;            var saleAttrValueName = $(span).find("select option:selected").text();            var saleAttrValueId = $(span).find("select option:selected").attr("saleattrvalueid");            skuInfo["skuSaleAttrValueList["+i+"].saleAttrValueId"] = saleAttrValueId;            skuInfo["skuSaleAttrValueList["+i+"].saleAttrValueName"] = saleAttrValueName;        })        //获取平台属性的数据        var spans = $("#attrInfoGroup >span");        console.log(spans);        $(spans).each(function (i,span) {            var attrId = $(span).attr("attrid");            var valueId = $(span).find("select option:selected").val();            skuInfo["skuAttrValueList["+i+"].attrId"] = attrId;            skuInfo["skuAttrValueList["+i+"].valueId"] = valueId;        })        var defaultImg = $("input[name='isD']:checked").val();        if(!defaultImg){            defaultImg = $("input[name='isD']").eq(0).val();        }        skuInfo["skuDefaultImg"] = defaultImg;        //获取图片数据        var checked = $("#skuImgDg").datagrid("getChecked");        $(checked).each(function (i,img) {            console.log(img)            var imgUrl = img.imgUrl;            var imgName= img.imgName;            var imgId= img.id;            skuInfo["skuImageList["+i+"].imgName"] = imgName;            skuInfo["skuImageList["+i+"].imgUrl"] =imgUrl;            skuInfo["skuImageList["+i+"].spuImgId"] =imgId;            if(img.imgUrl == defaultImg){                skuInfo["skuImageList["+i+"].isDefault"] ="1";            }        })        $.post("saveSku",skuInfo,function (response){            $("#sku_dlg").dialog("close")        })    }</script></html>